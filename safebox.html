<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ì´í”„ë°•ìŠ¤ ìƒì„¸ - ì‚¬ìš°íšŒ íšŒë¹„ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .card {
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.1);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .table-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .deposit-text {
            color: #f59e0b;
        }

        .withdraw-text {
            color: #10b981;
        }

        .interest-text {
            color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-green-600 to-green-700 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold">ğŸ”’ ì„¸ì´í”„ë°•ìŠ¤ ìƒì„¸</h1>
                    <p class="text-green-100 mt-2">ì¹´ì¹´ì˜¤ë±…í¬ ê°œì¸ê¸ˆê³  ìš´ìš© ë‚´ì—­</p>
                </div>
                <a href="index.html" class="bg-white text-green-600 px-4 py-2 rounded-lg font-medium hover:bg-green-50 transition">
                    â† ë©”ì¸ ëŒ€ì‹œë³´ë“œ
                </a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- ì„¸ì´í”„ë°•ìŠ¤ ìš”ì•½ ì¹´ë“œ -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“Š ì„¸ì´í”„ë°•ìŠ¤ ìš”ì•½</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="card bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium">í˜„ì¬ ë³´ê´€ì•¡</p>
                            <p class="text-3xl font-bold mt-2" id="current-balance">â‚©0</p>
                            <p class="text-xs text-green-200 mt-1">2025ë…„ 11ì›” 11ì¼ ê¸°ì¤€</p>
                        </div>
                        <div class="stat-icon bg-green-400">
                            <span>ğŸ”’</span>
                        </div>
                    </div>
                </div>

                <div class="card bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">ì´ ì…ê¸ˆì•¡</p>
                            <p class="text-2xl font-bold deposit-text mt-2" id="total-deposit">â‚©0</p>
                            <p class="text-xs text-gray-500 mt-1">ì„¸ì´í”„ë°•ìŠ¤ì— ë„£ì€ ê¸ˆì•¡</p>
                        </div>
                        <div class="stat-icon bg-orange-100 text-orange-600">
                            <span>ğŸ“¥</span>
                        </div>
                    </div>
                </div>

                <div class="card bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">ì´ ì¶œê¸ˆì•¡</p>
                            <p class="text-2xl font-bold withdraw-text mt-2" id="total-withdraw">â‚©0</p>
                            <p class="text-xs text-gray-500 mt-1">ì„¸ì´í”„ë°•ìŠ¤ì—ì„œ êº¼ë‚¸ ê¸ˆì•¡</p>
                        </div>
                        <div class="stat-icon bg-green-100 text-green-600">
                            <span>ğŸ“¤</span>
                        </div>
                    </div>
                </div>

                <div class="card bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">ì´ì ìˆ˜ìµ</p>
                            <p class="text-2xl font-bold interest-text mt-2" id="total-interest">â‚©0</p>
                            <p class="text-xs text-gray-500 mt-1" id="interest-count">-</p>
                        </div>
                        <div class="stat-icon bg-blue-100 text-blue-600">
                            <span>ğŸ’µ</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“ˆ ì„¸ì´í”„ë°•ìŠ¤ ìš´ìš© ë¶„ì„</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ì…ì¶œê¸ˆ ë¹„ìœ¨</h3>
                    <canvas id="ratioChart"></canvas>
                </div>

                <div class="card bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ì›”ë³„ ì„¸ì´í”„ë°•ìŠ¤ ì”ì•¡ ì¶”ì´</h3>
                    <canvas id="balanceChart"></canvas>
                </div>
            </div>
        </section>

        <!-- ì„¸ì´í”„ë°•ìŠ¤ ê±°ë˜ ë‚´ì—­ -->
        <section class="mb-8">
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ”„ ì„¸ì´í”„ë°•ìŠ¤ ê±°ë˜ ë‚´ì—­</h2>

                    <!-- í•„í„° -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <input
                                type="text"
                                id="search-input"
                                placeholder="ê²€ìƒ‰..."
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                            />
                        </div>

                        <div>
                            <select id="type-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="all">ëª¨ë“  ê±°ë˜</option>
                                <option value="deposit">ì…ê¸ˆ (ë„£ê¸°)</option>
                                <option value="withdraw">ì¶œê¸ˆ (êº¼ë‚´ê¸°)</option>
                                <option value="interest">ì´ì</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- í…Œì´ë¸” -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="table-header text-white">
                            <tr>
                                <th class="px-6 py-4 text-left text-sm font-semibold cursor-pointer hover:bg-green-700" onclick="sortTable('date')">
                                    ë‚ ì§œ <span id="sort-date">â†•ï¸</span>
                                </th>
                                <th class="px-6 py-4 text-left text-sm font-semibold cursor-pointer hover:bg-green-700" onclick="sortTable('type')">
                                    ìœ í˜• <span id="sort-type">â†•ï¸</span>
                                </th>
                                <th class="px-6 py-4 text-left text-sm font-semibold">ì„¤ëª…</th>
                                <th class="px-6 py-4 text-right text-sm font-semibold cursor-pointer hover:bg-green-700" onclick="sortTable('amount')">
                                    ê¸ˆì•¡ <span id="sort-amount">â†•ï¸</span>
                                </th>
                                <th class="px-6 py-4 text-right text-sm font-semibold">ì”ì•¡</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table">
                            <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="p-6 border-t border-gray-200 flex items-center justify-between">
                    <div class="text-sm text-gray-600">
                        <span id="showing-info">-</span>
                    </div>
                    <div class="flex gap-2" id="pagination">
                        <!-- í˜ì´ì§€ ë²„íŠ¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400">Â© 2025 ì‚¬ìš°íšŒ íšŒë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            <p class="text-gray-500 text-sm mt-2">ì„¸ì´í”„ë°•ìŠ¤ ìƒì„¸ í˜ì´ì§€</p>
        </div>
    </footer>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let dashboardData = null;
        let filteredTransactions = [];
        let currentPage = 1;
        const itemsPerPage = 15;
        let currentSort = { field: 'date', direction: 'desc' };
        let currentFilters = {
            search: '',
            type: 'all'
        };

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            try {
                const response = await fetch('dashboard_data.json');
                dashboardData = await response.json();
                initializeDashboard();
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        function initializeDashboard() {
            updateSummaryCards();
            updateCharts();
            filterAndDisplayTransactions();
        }

        // ê¸ˆì•¡ í¬ë§·íŒ…
        function formatCurrency(amount) {
            return 'â‚©' + amount.toLocaleString('ko-KR');
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            return `${year}ë…„ ${month}ì›” ${day}ì¼`;
        }

        // ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateSummaryCards() {
            const { summary } = dashboardData;

            document.getElementById('current-balance').textContent = formatCurrency(summary.safebox_balance);
            document.getElementById('total-deposit').textContent = formatCurrency(summary.safebox_deposit_total);
            document.getElementById('total-withdraw').textContent = formatCurrency(summary.safebox_withdraw_total);
            document.getElementById('total-interest').textContent = formatCurrency(summary.total_interest);
            document.getElementById('interest-count').textContent = `ì´ ${summary.interest_count}íšŒ ì´ì ì…ê¸ˆ`;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            createRatioChart();
            createBalanceChart();
        }

        // ì…ì¶œê¸ˆ ë¹„ìœ¨ ì°¨íŠ¸
        function createRatioChart() {
            const { summary } = dashboardData;

            const ctx = document.getElementById('ratioChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ì…ê¸ˆ (ë„£ê¸°)', 'ì¶œê¸ˆ (êº¼ë‚´ê¸°)'],
                    datasets: [{
                        data: [summary.safebox_deposit_total, summary.safebox_withdraw_total],
                        backgroundColor: [
                            'rgba(245, 158, 11, 0.7)',
                            'rgba(16, 185, 129, 0.7)'
                        ],
                        borderColor: [
                            'rgb(245, 158, 11)',
                            'rgb(16, 185, 129)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = summary.safebox_deposit_total + summary.safebox_withdraw_total;
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + formatCurrency(context.parsed) + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì”ì•¡ ì¶”ì´ ì°¨íŠ¸
        function createBalanceChart() {
            const { safebox_transactions } = dashboardData;

            // ë‚ ì§œìˆœ ì •ë ¬ (ì˜¤ë˜ëœ ê²ƒë¶€í„°)
            const sortedTransactions = [...safebox_transactions].sort((a, b) =>
                new Date(a.date) - new Date(b.date)
            );

            // ì›”ë³„ ë°ì´í„° ì¶”ì¶œ (ìµœê·¼ 12ê°œì›”)
            const labels = [];
            const balances = [];

            sortedTransactions.slice(-12).forEach(t => {
                const date = new Date(t.date);
                const label = `${date.getMonth() + 1}/${date.getDate()}`;
                labels.push(label);
                balances.push(t.balance_after);
            });

            const ctx = document.getElementById('balanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì„¸ì´í”„ë°•ìŠ¤ ì”ì•¡',
                        data: balances,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderColor: 'rgb(16, 185, 129)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return 'â‚©' + (value / 1000000) + 'M';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ì”ì•¡: ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    }
                }
            });
        }

        // ê±°ë˜ í•„í„°ë§ ë° í‘œì‹œ
        function filterAndDisplayTransactions() {
            const { safebox_transactions } = dashboardData;

            // í•„í„° ì ìš©
            filteredTransactions = safebox_transactions.filter(t => {
                // íƒ€ì… í•„í„°
                if (currentFilters.type !== 'all' && t.type !== currentFilters.type) {
                    return false;
                }

                // ê²€ìƒ‰ í•„í„°
                if (currentFilters.search) {
                    const searchLower = currentFilters.search.toLowerCase();
                    return t.description.toLowerCase().includes(searchLower);
                }

                return true;
            });

            // ì •ë ¬ ì ìš©
            sortTransactions();

            // í˜ì´ì§€ ë¦¬ì…‹
            currentPage = 1;

            // í…Œì´ë¸” ë Œë”ë§
            renderTransactionsTable();
            renderPagination();
        }

        // ê±°ë˜ ì •ë ¬
        function sortTransactions() {
            filteredTransactions.sort((a, b) => {
                let aVal, bVal;

                switch(currentSort.field) {
                    case 'date':
                        aVal = new Date(a.date);
                        bVal = new Date(b.date);
                        break;
                    case 'amount':
                        aVal = a.amount;
                        bVal = b.amount;
                        break;
                    case 'type':
                        aVal = a.type;
                        bVal = b.type;
                        break;
                    default:
                        return 0;
                }

                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // í…Œì´ë¸” ë Œë”ë§
        function renderTransactionsTable() {
            const startIdx = (currentPage - 1) * itemsPerPage;
            const endIdx = startIdx + itemsPerPage;
            const pageTransactions = filteredTransactions.slice(startIdx, endIdx);

            const tbody = document.getElementById('transactions-table');
            tbody.innerHTML = '';

            if (pageTransactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                            ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                document.getElementById('showing-info').textContent = 'ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ';
                return;
            }

            pageTransactions.forEach(t => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-200 hover:bg-gray-50 transition';

                // íƒ€ì… í‘œì‹œ
                let typeDisplay = '';
                let typeClass = '';
                switch(t.type) {
                    case 'deposit':
                        typeDisplay = 'ğŸ“¥ ì…ê¸ˆ (ë„£ê¸°)';
                        typeClass = 'deposit-text';
                        break;
                    case 'withdraw':
                        typeDisplay = 'ğŸ“¤ ì¶œê¸ˆ (êº¼ë‚´ê¸°)';
                        typeClass = 'withdraw-text';
                        break;
                    case 'interest':
                        typeDisplay = 'ğŸ’µ ì´ì';
                        typeClass = 'interest-text';
                        break;
                }

                // ê¸ˆì•¡ í‘œì‹œ
                const amountClass = t.type === 'deposit' ? 'deposit-text' : t.type === 'withdraw' ? 'withdraw-text' : 'interest-text';
                const amountPrefix = t.type === 'deposit' ? '-' : '+';

                tr.innerHTML = `
                    <td class="px-6 py-4 text-sm text-gray-900">${formatDate(t.date)}</td>
                    <td class="px-6 py-4 text-sm font-medium ${typeClass}">${typeDisplay}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${t.description}</td>
                    <td class="px-6 py-4 text-sm font-semibold ${amountClass} text-right">${amountPrefix}${formatCurrency(t.amount)}</td>
                    <td class="px-6 py-4 text-sm text-gray-600 text-right">${formatCurrency(t.balance_after)}</td>
                `;

                tbody.appendChild(tr);
            });

            // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
            const total = filteredTransactions.length;
            document.getElementById('showing-info').textContent =
                `${startIdx + 1}-${Math.min(endIdx, total)} / ì´ ${total}ê±´`;
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
        function renderPagination() {
            const totalPages = Math.ceil(filteredTransactions.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (totalPages <= 1) return;

            // ì´ì „ ë²„íŠ¼
            const prevBtn = createPaginationButton('ì´ì „', currentPage > 1, () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTransactionsTable();
                    renderPagination();
                }
            });
            pagination.appendChild(prevBtn);

            // í˜ì´ì§€ ë²ˆí˜¸
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = createPaginationButton(i, true, () => {
                    currentPage = i;
                    renderTransactionsTable();
                    renderPagination();
                }, i === currentPage);
                pagination.appendChild(pageBtn);
            }

            // ë‹¤ìŒ ë²„íŠ¼
            const nextBtn = createPaginationButton('ë‹¤ìŒ', currentPage < totalPages, () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTransactionsTable();
                    renderPagination();
                }
            });
            pagination.appendChild(nextBtn);
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìƒì„±
        function createPaginationButton(text, enabled, onClick, isActive = false) {
            const btn = document.createElement('button');
            btn.textContent = text;
            btn.className = `px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium transition ${isActive ? 'bg-green-600 text-white' : 'hover:bg-gray-100'}`;
            btn.disabled = !enabled;
            if (!enabled) btn.className += ' opacity-50 cursor-not-allowed';
            btn.onclick = onClick;
            return btn;
        }

        // í…Œì´ë¸” ì •ë ¬
        function sortTable(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'desc';
            }

            // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="sort-"]').forEach(el => {
                el.textContent = 'â†•ï¸';
            });

            const icon = currentSort.direction === 'asc' ? 'â†‘' : 'â†“';
            document.getElementById(`sort-${field}`).textContent = icon;

            filterAndDisplayTransactions();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            // ë°ì´í„° ë¡œë“œ
            loadData();

            // ê²€ìƒ‰ ì…ë ¥
            document.getElementById('search-input').addEventListener('input', (e) => {
                currentFilters.search = e.target.value;
                filterAndDisplayTransactions();
            });

            // íƒ€ì… í•„í„°
            document.getElementById('type-filter').addEventListener('change', (e) => {
                currentFilters.type = e.target.value;
                filterAndDisplayTransactions();
            });
        });
    </script>
</body>
</html>
