# ========================================
# Render.com Blueprint Configuration
# ========================================
# 이 파일은 Render.com에서 자동으로 읽어 인프라를 생성합니다
# https://render.com/docs/blueprint-spec

services:
  # ========================================
  # PostgreSQL Database
  # ========================================
  - type: pserv
    name: election-db
    plan: free
    region: singapore
    databaseName: election_db
    databaseUser: election_user
    ipAllowList: []

  # ========================================
  # Backend API (NestJS)
  # ========================================
  - type: web
    name: election-backend
    runtime: node
    region: singapore
    plan: free
    branch: claude/integrate-alumni-management-013hFeLMtj7GCrq5UeqpHTSt
    buildCommand: cd apps/backend && npm install && npx prisma generate && npm run build
    startCommand: cd apps/backend && npx prisma migrate deploy && npm run start:prod
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: DATABASE_URL
        fromDatabase:
          name: election-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: BALLOT_SECRET_SALT
        generateValue: true
      - key: CORS_ORIGIN
        sync: false
    autoDeploy: true

  # ========================================
  # Static Site (Optional - for docs/landing)
  # ========================================
  # Frontend는 Vercel에서 배포하므로 주석 처리
  # - type: web
  #   name: election-frontend
  #   runtime: node
  #   region: singapore
  #   plan: free
  #   buildCommand: cd apps/frontend && npm install && npm run build
  #   startCommand: cd apps/frontend && npm start
  #   envVars:
  #     - key: NEXT_PUBLIC_API_URL
  #       fromService:
  #         type: web
  #         name: election-backend
  #         envVarKey: RENDER_EXTERNAL_URL
